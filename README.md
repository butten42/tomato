番茄时钟是FCC上的四个（*计算器，番茄时钟，井字游戏，SIMON游戏*）高级实战项目之一。
基本要求：
- 有番茄时间和休息时间的设置
- 开始番茄后以设定时间起倒计时（我使用标准电子时钟样式）
- 暂停时钟倒计时暂停
- 番茄时间过后自动滚入休息时间并倒计时
- 休息时间过后进入番茄时间，如此往复

PLUS：
- 时钟随着倒计时有充满的动画效果
- 番茄计时结束后播放音乐

#开始
###构建HTML和CSS做好样式
没有什么难的，我在制作时钟调节按钮的时候特意用了一下之前学到的使用span标签制作三角形的技术。
###脚本
 - - -
先是对时间设置功能的实现
基本就是一个简单的事件相应过程，增加/减少按钮按到了对应的显示区域的数字也增加/减少。

然后是点击倒计时功能
这一步可以分为好几步：
- 获得设定的值
- 将获取到的数据转化为对应的格式
- 倒计时
- 倒计时结束动作（播放音乐，滚入休息倒计时）

难点在于转化格式
在获得到一个整数之后，比如“25”，我先把他转化为秒数，然后地板除取得冒号两边的数，返回。
在第一版的时候我觉得这样就够了，倒计时能够正确显示，但是有一个问题在于当两边表示分钟和秒数的值只有个位数的时候，倒计时格式很不规范了。
于是需要做一个条件判断，返回正确的格式。
```
function convent(n){
    var m=Math.floor(n/60);
    var s=Math.floor(n%60);
    if(m<10) {m='0'+m;}
    if(s<10) {s="0"+s;}
    return m+":"+s;
}
```

在有了正确的返回格式后，就要处理倒计时的动态显示了
这里主要就是设置时间
setTimeout和setinterval的区别
前者在时间过后执行一次函数，后者没过一个设定时间执行函数
我记得我最开始是使用的后者，但后来大概是方便把在函数里调用前者也起到了同样的作用。

```
timeId=setTimeout(func,time)//接受一个函数，时间（毫秒）
```

```
cleartimeout(timeId)//利用settimeout的方法id清除设定的时间
```

动态的充满图像
这个在我的第一版里也是没有的，我最开始是想改变背景颜色的高度，或是从底下慢慢拉一个块上来，但是这些尝试都失败了，
在第一版里我只是在点击开始之后给倒计时的显示块改变了背景色。
正确的是给对应div里添加一个span标签，绝对定位，对齐，不给高度，宽度和块的宽度一样，块添加overflow：hidden。
然后获得当前相应时间和总时间的比值，乘以高度，
和上面的一起的代码就是这样子的：
```
if(showTime>0){
            showTime--;
            show.textContent=convent(showTime);
            var fillH=1-(showTime/(tomato.innerHTML*60));
            fill.style.height=fillH*200+'px';
            timer=setTimeout(startTomato,1000);
        }
```
结束动作
结束后要播放音乐，休息时间开始倒计时
音乐（audio）标签是H5新加的，属性有src和controls，不同浏览器支持的格式不同，所以我放了ogg和mp3两种格式的文件来做兼容
```
    var o="amongthepoor.ogg";
    var q="amongthepoor.mp3";
    var ogg=new Audio(o);
    var mp3=new Audio(q);
```
当番茄时间不再大于0了，开始进入休息时间，同时播放音乐，对背景填充复位。
```
if(breakTime>0){
            breakTime--;
            show.innerHTML=convent(breakTime);
            bt=setTimeout(startTomato,1000);
            ogg.play()||mp3.play();
            fill.style.height=0;
            }
```
开始后再次按到倒计时区块会停止这次番茄时间，开始设定中制定的倒时间，
需要设定一个全局变量默认为false，点击后翻转属性。

陆陆续续把全部用户故事完成了。用时大概有个20小时吧，暴露出的问题还是挺多的，我的基本功还是不行啊，在对时间做格式转化的时候居然去取数字的长度，还坑了好一段时间。
很多时间都要去查，背景高度的应用等等。
最终项目在此: [Tomato](https://butten42.github.io/tomato)
